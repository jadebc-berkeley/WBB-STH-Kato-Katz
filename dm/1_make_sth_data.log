---------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/jadederong/documents/crg/wash-benefits/bangladesh/src/sth/dm/
> 1_make_sth_data.log
  log type:  text
 opened on:  31 Aug 2016, 12:34:55

. 
. *********************************************
. * WASH Benefits Bangladesh
. * STH Kato-Katz analysis
. 
. * Make analysis dataset
. 
. * by Jade
. *********************************************
. clear all

. set more off

. *cd "~/Dropbox/WASHB-Bangladesh-Data/0-Untouched-data/2-STH-kato-katz/"
. 
. 
. *--------------------------------------------
. * Read in KK data 
. *--------------------------------------------
. use "/Users/jadederong/Dropbox/WASHB Parasites/Temp Data/2-WASHB-P-kk-temp.dta"

. 
. * drop spillover children
. drop if personid=="S1"
(2,690 observations deleted)

. 
. *--------------------------------------------
. * Take average of KK egg counts, create binary variables
. *--------------------------------------------
. destring original*, replace
originalAL has all characters numeric; replaced as int
(1 missing value generated)
originalTT has all characters numeric; replaced as int
originalHW has all characters numeric; replaced as int

. 
. collapse (mean) originalAL originalTT originalHW, by(dataid labdate personid)

. 
. ren originalAL alepg

. ren originalTT ttepg

. ren originalHW hwepg

. 
. gen al = (alepg>0)

. gen tt = (ttepg>0)

. gen hw = (hwepg>0)

. 
. gen alint=0

. replace alint=1 if alepg>=1 & alepg<5000
(2,617 real changes made)

. replace alint=2 if alepg>=5000 & alepg<50000
(3 real changes made)

. replace alint=3 if alepg>=50000
(0 real changes made)

. replace alint=. if alepg==.
(0 real changes made)

. 
. gen ttint=0

. replace ttint=1 if ttepg>=1 & ttepg<5000
(501 real changes made)

. replace ttint=2 if ttepg>=5000 & ttepg<50000
(0 real changes made)

. replace ttint=3 if ttepg>=50000
(0 real changes made)

. replace ttint=. if ttepg==.
(0 real changes made)

. 
. gen hwint=0

. replace hwint=1 if hwepg>=1 & hwepg<5000
(553 real changes made)

. replace hwint=2 if hwepg>=5000 & hwepg<50000
(0 real changes made)

. replace hwint=3 if hwepg>=50000
(0 real changes made)

. replace hwint=. if hwepg==.
(0 real changes made)

. 
. label define intl 0 "No infection" 1 "Low intensity" 2 "Moderate intensity" 3 "
> High intensity"

. label values alint ttint hwint intl

. 
. gen almh=0

. replace almh=1 if alint==2 | alint==3
(3 real changes made)

. replace almh=. if alint==. 
(0 real changes made)

. 
. gen ttmh=0

. replace ttmh=1 if ttint==2 | ttint==3
(0 real changes made)

. replace ttmh=. if ttint==. 
(0 real changes made)

. 
. gen hwmh=0

. replace hwmh=1 if hwint==2 | hwint==3
(0 real changes made)

. replace hwmh=. if hwint==. 
(0 real changes made)

. 
. label define mhl 0 "No/low intensity infection" 1 "Moderate/heavy infection"

. label values almh ttmh hwmh mhl

. 
. label variable alepg "Ascaris eggs per gram"

. label variable ttepg "Trichuris eggs per gram"

. label variable hwepg "Hookworm eggs per gram"

. 
. label variable al "Any Ascaris eggs"

. label variable tt "Any Trichuris eggs"

. label variable hw "Any hookworm eggs"

. 
. label variable alint "Ascaris infection intensity"

. label variable ttint "Any infection intensity"

. label variable hwint "Any infection intensity"

. 
. label variable almh "Moderate/heavy Ascaris infection"

. label variable ttmh "Moderate/heavy Trichuris infection"

. label variable hwmh "Moderate/heavy hookworm infection"

. 
. *--------------------------------------------
. * Merge with baseline covariates
. *--------------------------------------------
. * CHANGE THIS directory later
. merge m:1 dataid using "~/Dropbox/WASHB Parasites/Temp Data/primary/washb-bangl
> adesh-hbgdki-enrol.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,643
        from master                         0  (_merge==1)
        from using                      1,643  (_merge==2)

    matched                             7,187  (_merge==3)
    -----------------------------------------

. 
. * drop if no KK data
. drop if _m==2
(1,643 observations deleted)

. drop _m

. 
. *--------------------------------------------
. * Merge in treatment assignment
. *--------------------------------------------
. merge m:1 dataid using "~/Dropbox/WASHB-Bangladesh-Data/0-Untouched-data/1-Main
> -survey/1_Baseline/0. WASHB_Blinded_tr_assignment.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,643
        from master                         0  (_merge==1)
        from using                      1,643  (_merge==2)

    matched                             7,187  (_merge==3)
    -----------------------------------------

. * drop if no KK data
. drop if _m==2
(1,643 observations deleted)

. drop _m

. 
. * create variable for any sth infection
. gen sth=.
(7,187 missing values generated)

. replace sth=1 if al==1 | hw==1 | tt==1
(3,045 real changes made)

. replace sth=0 if al==0 & hw==0 & tt==0
(4,142 real changes made)

. 
. order dataid personid tr

. 
. save "~/Dropbox/WASH Benefits/Bangladesh/STH/Data/sth.dta", replace
file ~/Dropbox/WASH Benefits/Bangladesh/STH/Data/sth.dta saved

. outsheet using "~/Dropbox/WASH Benefits/Bangladesh/STH/Data/sth.csv", replace c
> omma

. 
. log close
      name:  <unnamed>
       log:  /Users/jadederong/documents/crg/wash-benefits/bangladesh/src/sth/dm/
> 1_make_sth_data.log
  log type:  text
 closed on:  31 Aug 2016, 12:34:57
---------------------------------------------------------------------------------
